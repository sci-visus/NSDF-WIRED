## Here you find conversions of all the netCDF files downloaded using workflow in `data_download` to the OpenVisus IDX file format.

For all versions, the same general process is followed:
1. Check which netCDF files successfully downloaded from `firesmoke.ca` by attempting to open each downloaded file with `xarray`. Need to check this since `wget` will download `.html` file if no netCDF file was found during download.
2. Step though all files in chronological sequence, hour by hour, and save data at each hour to `.idx` using the [OpenVisus](https://github.com/sci-visus/OpenVisus/tree/master) framework.
---
## The following is how our approach to conversion changed in each version:

firesmoke_to_idx_v1:
---
Initially, we used just the BSC00CA12-01 dataset as this ran the longest (until 2024).

firesmoke_to_idx_v2:
---
We realized that the latitude longitude grid of the BSC00CA12-01 was either of size 1041x381 or 1081x381. Here we resample the smaller to the larger grid accordingly.

firesmoke_to_idx_v3:
---
Instead of using just BSC00CA12-01 we use all available datasets, BSC06CA12-01,BSC12CA12-01, and BSC18CA12-01. These forecasts are the same model but with new starting parameters, each dataset corresponds to the initialization time. Further details can be found at [firesmoke.ca/forecasts](https://firesmoke.ca/forecasts/).

firesmoke_to_idx_v4:
---
Similarly to v3, we use all available datasets. But now we use dates 3/3/2024 - 6/27/2024. And, the sequencing produced from v3 did not correctly sample from all available datasets which lead to missing hours in our IDX conversion. The reason for this was, for each timestep we only searched the dispersion files that were on the YYYYMMDD of the timestamp and yesterday. However, we could search the previous 4 days of files as well if the timestamp was not found in those files. The sequencing script was thus fixed accordingly in v4. Additionally we modularized and rewrote the script for clarity and correctness. 

firesmoke_to_idx_v5:
---
In this script, we use the new naming scheme for the dispersion.nc files downloaded from [firesmoke.ca/forecasts](https://firesmoke.ca/forecasts/). Namely, we no longer rely on forecast names but directly name each file with the date they were created (CDATE_CTIME). This simplifies selecting the latest forecast for a given time step when exploring the previous 4 days of files from the time step. The dataset in this script uses files created from 3/3/2024 - 11/10/2025.

conversion_sequence_debug.ipynb
---
In this script we inspect the sequence generated by firesmoke_to_idx_v4. We ensure that all hours are accounted for and missing hours are diagnosed _before_ we do the conversion to IDX and then find missing hours. For dates 3/3/2024 - 6/27/2024 there are missing hours that we believe are a result of missing netCDF files.

firesmoke_to_idx2:
---
Not complete yet, but it is for later use to convert the firesmoke data to the IDX2 data format.

westerncanada_parallel_idx.ipynb
---
This script is a parallelized IDX conversion of the [BSC00WC04-01](https://firesmoke.ca/forecasts/BSC00WC04-01/current/) dataset to an IDX file.
